<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no" />
    <title>Installing the signal-cli on the Raspberry Pi.</title>
    <link rel="alternate" type="application/rss+xml" href="/feed.xml" title="Nick's Site" />
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <link rel="stylesheet" href="/basic-4fa2674f.css" />
    <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml">
    <meta property="og:title" content="Installing the signal-cli on the Raspberry Pi." />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:description" content="This is a guide for installing the signal-cli on the Raspberry Pi." />
    <meta name="description" content="This is a guide for installing the signal-cli on the Raspberry Pi.">
    <meta property="og:site_name" content="Nick's Site" />
    <meta property="article:published_time" content="2022-08-21" />
    <meta property="article:section" content="Technology" />
    <meta property="article:tag" content="Raspberry Pi" />
    <meta property="article:tag" content="Signal" />
    

</head>
<body>
    <header>
        <a id="top"></a>
        <h1 class="center"><a href="/">Nick's Site</a></h1>

        <div class="menu">
            <p><a href="/sites/recommendations">Blog recommendations</a></p>
            <p><a href="/sites/links">link collection</a></p>
            <p><a href="/sites/privacy">Privacy Policy</a></p>
            <p><a href="/sites/imprint">Imprint</a></p>
            <p><a href="/feed.xml">RSS</a></p>
        </div>
    </header>
    <main>
        <span class="menu">
            <article class="content">
                
                    <div>
                        <h1>Installing the signal-cli on the Raspberry Pi. (21.08.2022)</h1>
                    </div>
                
                <h1>Notice</h1>
<p>As of 31.03.2023 this guide is not working correctly! Because of that reason the script got renamed to <code>signal-cli-install-old.sh</code>.</p>
<p>At the time of writing this, the signal-cli is at version: <code>0.11.3</code> with the libsignal-client being at version: <code>0.20.0</code>.<br>
The OS that I use is <a href="https://github.com/MichaIng/DietPi">DietPi</a>.</p>
<h1>Usage</h1>
<p>The signal-cli could be useful for sending automatic messages, e.g. when a service/job fails.
For example, when your database backup fails, you can get the notification right into Signal.</p>
<h1>Automatic install</h1>
<p>For an automatic install, I provide the following script:</p>
<p>You can use it by running:<br>
<code>sudo wget https://nickwasused.com/blog/2022-08-21-raspberry-pi-signal-cli/signal-cli-install.sh</code><br>
Notice! Before running scripts from the Internet, check their code.<br>
<code>cat ./signal-cli.install.sh</code><br>
Now you can run the script:<br>
<code>sudo chmod +x ./signal-cli-install.sh &amp;&amp; sudo ./signal-cli.install.sh</code></p>
<h1>Manual install</h1>
<h1>precautions</h1>
<p>You need to check the size of your <code>/tmp</code> directory with the following command:<br>
<code>df -h</code></p>
<p>There will be a line that looks like this:<br>
<code>tmpfs           1.0G  1.0M 1023M   1% /tmp</code></p>
<p>Notice that is reads <code>1.0G</code>. This is too small as the installation requires about 1.25G.</p>
<p>You can expand the size of your <code>/tmp</code> directory with this command:<br>
<code>sudo mount -o remount,size=2G /tmp/</code></p>
<h1>required tools</h1>
<p>For this guide, <code>curl</code> and <code>zip</code> are required. Install them with:<br>
<code>sudo apt install curl zip</code></p>
<p>(If there is an error try to run <code>sudo apt update</code>)</p>
<h2>Basic install</h2>
<p>First, we need to set the Version of the signal-cli we are installing. You can find the Version code <a href="https://github.com/AsamK/signal-cli/releases">here</a>.</p>
<p>Set the signal-cli version with:<br>
<code>export VERSION=0.11.3</code>.<br>
After that, we download the signal-cli version:<br>
<code>curl --proto '=https' --tlsv1.2 -o signal-cli-&quot;${VERSION}&quot;-Linux.tar.gz https://github.com/AsamK/signal-cli/releases/download/v&quot;${VERSION}&quot;/signal-cli-&quot;${VERSION}&quot;-Linux.tar.gz</code><br>
and unpack it to <code>/opt</code>:<br>
<code>sudo tar xf signal-cli-&quot;${VERSION}&quot;-Linux.tar.gz -C /opt</code>.
After extracting the code remove the file:<br>
<code>sudo rm signal-cli-&quot;${VERSION}&quot;-Linux.tar.gz</code><br>
Finally, we link it to <code>/usr/local/bin</code> so we can use the signal-cli:<br>
<code>sudo ln -sf /opt/signal-cli-&quot;${VERSION}&quot;/bin/signal-cli /usr/local/bin/</code>.</p>
<p>As the last step for the basic install, we install the required Java version:<br>
<code>sudo apt install openjdk-17-jdk</code></p>
<h3>Info</h3>
<p>If we try to run <code>signal-cli</code> now, then it will fail! (But only if your system type is not <code>x86_64</code>)</p>
<h2>Building the libsignal_jni.so</h2>
<p>To fix the problem, we need to build the &quot;native lib for libsignal&quot;.</p>
<p>Notice! If you have a 1GB Raspberry Pi then please read <a href="#1-gb-ram">#1-gb-ram</a>.</p>
<h3>Dependencies</h3>
<p>First, we need to install some dependencies:</p>
<h4>apt</h4>
<p><code>sudo apt install protobuf-compiler clang libclang-dev cmake make</code></p>
<h4>rust</h4>
<p><code>sudo curl https://sh.rustup.rs -sSf | sudo sh -s -- --default-toolchain nightly-aarch64-unknown-linux-gnu -y</code></p>
<h3>Build libsignal</h3>
<p>Let's create a temporary directory to store files:<br>
<code>sudo mkdir /tmp/signal-cli-install &amp;&amp; cd /tmp/signal-cli-install</code></p>
<p>Before starting to download the libsignal source-code, we need to find the matching version code:<br>
<code>export LIBVERSION=$(find /opt/signal-cli-&quot;${VERSION}&quot;/lib/ -maxdepth 1 -mindepth 1 -name 'libsignal-client-*' | sed -E 's/\/opt\/signal-cli-[0-9]{1,}.[0-9]{1,}.[0-9]{1,}\/lib\/libsignal-client-*//g' | sed -E 's/.jar//g')</code></p>
<p>After that, we download the source code:<br>
<code>sudo curl --proto '=https' --tlsv1.2 -o /tmp/signal-cli-install/v&quot;${LIBVERSION}&quot;.tar.gz https://github.com/signalapp/libsignal/archive/refs/tags/v&quot;${LIBVERSION}&quot;.tar.gz</code></p>
<p>And now we need to unpack the downloaded code:<br>
<code>sudo tar xf /tmp/signal-cli-install/v&quot;${LIBVERSION}&quot;.tar.gz -C /tmp/signal-cli-install/ &amp;&amp; mv libsignal-&quot;${LIBVERSION}&quot; libsignal</code></p>
<p>After extracting the code remove the archive as it is no longer needed:
<code>sudo rm /tmp/signal-cli-install/v&quot;${LIBVERSION}&quot;.tar.gz</code></p>
<p>Change into the java directory of the downloaded code:<br>
<code>cd libsignal/java</code></p>
<p>We disable some android stuff as we don`t want to build for android:<br>
<code>sudo sed -i &quot;s/include ':android'//&quot; /tmp/signal-cli-install/libsignal/java/settings.gradle</code></p>
<h4>1 GB Ram</h4>
<p>While building libsignal I ran into a problem with the ram usage on the Raspberry Pi 3b, because eventually, the 1 GB of ram would be full. This would result in a locked-up Pi that I had to hard reset. We can work around this problem by limiting the CPU usage to 1 Core.<br>
(I don't know if a 2 GB Raspberry Pi 4 can run all 4 Cores.)</p>
<p><code>sudo sed -i &quot;s/cargo build /cargo build -j ${CORE_COUNT} /&quot; /tmp/signal-cli-install/libsignal/java/build_jni.sh</code></p>
<h5>Update 08.10.2022</h5>
<p>I could not get libsignal to compile on a Raspberry Pi with 1GB of ram.</p>
<h4>Starting the Build</h4>
<p>We can start the build with:
<code>sudo /tmp/signal-cli-install/libsignal/java/build_jni.sh desktop</code></p>
<p>We need to remove the bundled <code>libsignal_jni.so</code> from <code>/opt/signal-cli-${VERSION}/lib/libsignal-client-*.jar</code>:<br>
<code>sudo zip -d /opt/signal-cli-${VERSION}/lib/libsignal-client-*.jar libsignal_jni.so</code><br>
and add our own:<br>
<code>sudo zip /opt/signal-cli-${VERSION}/lib/libsignal-client-*.jar /tmp/signal-cli-install/libsignal/target/release/libsignal_jni.so</code></p>
<p>Since Version 0.11.3 the replacing is not working for me, because of that we add the <code>libsignal_jni.so</code> to the default Java library path.<br>
For that create it if it dosen`t exist:
<code>sudo mkdir -p /usr/java/packages/lib</code><br>
and finally copy the file to that folder:<br>
<code>sudo cp /tmp/signal-cli-install/libsignal/target/release/libsignal_jni.so /usr/java/packages/lib</code></p>
<p>Now we can remove the temporary files:<br>
<code>sudo rm -r /tmp/signal-cli-install</code></p>
<p>We should set the permissions for the new files:<br>
<code>sudo chown root:root /usr/java/packages/lib/libsignal_jni.so</code><br>
<code>sudo chmod 755 /usr/java/packages/lib/libsignal_jni.so</code><br>
<code>sudo chmod 755 -R /opt/signal-cli-${VERSION}</code><br>
<code>sudo chown root:root -R /opt/signal-cli-${VERSION}</code></p>
<p>Now we should be able to use the <code>signal-cli</code> command with no problems.</p>
<p>Finally the signal-cli should report it<code>s version with:   </code>signal-cli --version`</p>
<h1>Source</h1>
<p><a href="https://github.com/AsamK/signal-cli#install-system-wide-on-linux">https://github.com/AsamK/signal-cli#install-system-wide-on-linux</a>
<a href="https://github.com/AsamK/signal-cli/wiki/Provide-native-lib-for-libsignal#manual-build">https://github.com/AsamK/signal-cli/wiki/Provide-native-lib-for-libsignal#manual-build</a><br>
<a href="https://github.com/signalapp/libsignal">https://github.com/signalapp/libsignal</a></p>
<h3>archive</h3>
<p>The following links are archived versions, as the main ones could break.</p>
<p><a href="https://web.archive.org/web/20240519173122/https://github.com/MichaIng/DietPi">https://github.com/MichaIng/DietPi</a><br>
<a href="https://web.archive.org/web/20240519173219/https://github.com/AsamK/signal-cli/releases">https://github.com/AsamK/signal-cli/releases</a></p>

                <hr />
                <a href="#top" style="padding-bottom: 1.5%;">Back to top</a>
            </article>
        </span>
    </main>
</body>
<footer>
    <script async defer src="https://tracking.nickwasused.com/tracker.js" data-website-id="clz8folj200017udh53abr7ny"></script>
</footer>
</html>